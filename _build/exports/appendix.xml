<article xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:ali="http://www.niso.org/schemas/ali/1.0/" dtd-version="1.3" xml:lang="en">
  <body>
    <p>/SequentialEGM</p>
    <p>document</p>
    <p>Web</p>
    <p>[Appendices]Appendices</p>
    <sec id="app:df_r">
      <title>Solving the illustrative G2EGM model with EGM
        <inline-formula>
          <tex-math><![CDATA[^n]]></tex-math>
        </inline-formula>
      </title>
      <sec id="the-problem-for-a-retired-household">
        <title>The problem for a retired household</title>
        <p>I designate as
          <inline-formula>
            <tex-math><![CDATA[\wFunc_{t}(\mRat_{t})]]></tex-math>
          </inline-formula> the problem of a retired household at time
          <inline-formula>
            <tex-math><![CDATA[t]]></tex-math>
          </inline-formula> with total resources
          <inline-formula>
            <tex-math><![CDATA[\mRat]]></tex-math>
          </inline-formula>. The retired household solves a simple consumption-savings problem with no income uncertainty and a certain next period pension of
          <inline-formula>
            <tex-math><![CDATA[\underline{\tShkEmp}]]></tex-math>
          </inline-formula>.
        </p>
        <disp-formula>
          <label>(1)</label>
          <tex-math><![CDATA[\begin{split}
        \wFunc_{t}(\mRat_{t}) & = \max_{\cRat_{t}} \util(\cRat_{t}) +
        \DiscFac \wFunc_{t+1}(\mRat_{t}) \\
        & \text{s.t.} \\
        \aRat_{t} & = \mRat_{t} - \cRat_{t} \\
        \mRat_{t+1} & = \Rfree_{\aRat} \aRat_{t} +
        \underline{\tShkEmp}
    \end{split}]]></tex-math>
        </disp-formula>
        <p>Notice that there is no uncertainty and the household receives a retirement</p>
        <p>income
          <inline-formula>
            <tex-math><![CDATA[\underline{\tShkEmp}]]></tex-math>
          </inline-formula> every period until death.
        </p>
      </sec>
    </sec>
    <sec id="the-problem-for-a-worker-household">
      <title>The problem for a worker household</title>
      <p>The value function of a worker household is</p>
      <disp-formula>
        <label>(2)</label>
        <tex-math><![CDATA[\VFunc_{t}(\mRat_{t}, \nRat_{t}) = \Ex_\error \max \left\{
    \vFunc_{t}(\mRat_{t}, \nRat_{t}, \Work) + \sigma_{\error}
    \error_{\Work} ,
    \vFunc_{t}(\mRat_{t}, \nRat_{t}, \Retire) + \sigma_{\error}
    \error_{\Retire} \right\}]]></tex-math>
      </disp-formula>
      <p>where the choice specific problem for a working household that decides to</p>
      <p>continue working is</p>
      <disp-formula>
        <label>(3)</label>
        <tex-math><![CDATA[\begin{split}
        \vFunc_{t}(\mRat_{t}, \nRat_{t}, \Work) & = \max_{\cRat_{t},
            \dRat_{t}} \util(\cRat_{t}) - \kapShare + \DiscFac
        \Ex_{t} \left[
            \VFunc_{t+1}(\mRat_{t+1}, \nRat_{t+1})
            \right] \\
        & \text{s.t.} \\
        \aRat_{t} & = \mRat_{t} - \cRat_{t} - \dRat_{t} \\
        \bRat_{t} & = \nRat_{t} + \dRat_{t} + \gFunc(\dRat_{t}) \\
        \mRat_{t+1} & = \Rfree_{\aRat} \aRat_{t} + \tShkEmp_{t+1} \\
        \nRat_{t+1} & = \Rfree_{\bRat} \bRat_{t}
    \end{split}]]></tex-math>
      </disp-formula>
      <p>and the choice specific problem for a working household that decides to retire</p>
      <p>is</p>
      <disp-formula>
        <label>(4)</label>
        <tex-math><![CDATA[\vFunc_{t}(\mRat_{t}, \nRat_{t}, \Retire) =
    \wFunc_{t}(\mRat_{t}+\nRat_{t})]]></tex-math>
      </disp-formula>
    </sec>
    <sec id="applying-the-sequential-egm">
      <title>Applying the Sequential EGM</title>
      <p>The first step is to define a post-decision value function. Once the household</p>
      <p>decides their level of consumption and pension deposits, they are left with</p>
      <p>liquid assets they are saving for the future and illiquid assets in their</p>
      <p>pension account which they can’t access again until retirement. The</p>
      <p>post-decision value function can be defined as</p>
      <disp-formula>
        <label>(5)</label>
        <tex-math><![CDATA[\begin{split}
        \vEnd_{t}(\aRat_{t}, \bRat_{t}) & =  \DiscFac
        \Ex_{t} \left[ \VFunc_{t+1}(\mRat_{t+1}, \nRat_{t+1}) \right] \\
        & \text{s.t.} \\
        \mRat_{t+1} & = \Rfree_{\aRat} \aRat_{t} + \tShkEmp_{t+1} \\
        \nRat_{t+1} & = \Rfree_{\bRat} \bRat_{t}
    \end{split}]]></tex-math>
      </disp-formula>
      <p>Then redefine the working agent’s problem as</p>
      <disp-formula>
        <label>(6)</label>
        <tex-math><![CDATA[\begin{split}
        \vFunc_{t}(\mRat_{t}, \nRat_{t}, \Work) & = \max_{\cRat_{t},
            \dRat_{t}} \util(\cRat_{t})  - \kapShare + \vEnd_{t}(\aRat_{t},
        \bRat_{t}) \\
        \aRat_{t} & = \mRat_{t} - \cRat_{t} - \dRat_{t} \\
        \bRat_{t} & = \nRat_{t} + \dRat_{t} + \gFunc(\dRat_{t}) \\
    \end{split}]]></tex-math>
      </disp-formula>
      <p>Clearly, the structure of the problem remains the same, and this is the problem</p>
      <p>that G2EGM solves. We’ve only moved some</p>
      <p>of the stochastic mechanics out of the problem. Now, we can apply the</p>
      <p>sequential EGM
        <inline-formula>
          <tex-math><![CDATA[^n]]></tex-math>
        </inline-formula> method. Let the agent first decide
        <inline-formula>
          <tex-math><![CDATA[\dRat_{t}]]></tex-math>
        </inline-formula>, the deposit
      </p>
      <p>amount into their retirement; we will call this the deposit problem, or outer loop. Thereafter, the</p>
      <p>agent will have net liquid assets</p>
      <p>of
        <inline-formula>
          <tex-math><![CDATA[\lRat_{t}]]></tex-math>
        </inline-formula> and pension assets of
        <inline-formula>
          <tex-math><![CDATA[\bRat_{t}]]></tex-math>
        </inline-formula>.
      </p>
      <disp-formula>
        <label>(7)</label>
        <tex-math><![CDATA[\begin{split}
        \vFunc_{t}(\mRat_{t}, \nRat_{t}, \Work) & = \max_{\dRat_{t}}
        \vOpt_{t}(\lRat_{t}, \bRat_{t}) \\
        & \text{s.t.} \\
        \lRat_{t} & = \mRat_{t} - \dRat_{t} \\
        \bRat_{t} & = \nRat_{t} + \dRat_{t} + \gFunc(\dRat_{t})
    \end{split}]]></tex-math>
      </disp-formula>
      <p>Now, the agent can move on to picking their consumption and savings; we can call this</p>
      <p>the pure consumption problem or inner loop.</p>
      <disp-formula>
        <label>(8)</label>
        <tex-math><![CDATA[\begin{split}
        \vOpt_{t}(\lRat_{t}, \bRat_{t}) & = \max_{\cRat_{t}}
        \util(\cRat_{t}) - \kapShare  + \vEnd_{t}(\aRat_{t}, \bRat_{t}) \\
        & \text{s.t.} \\
        \aRat_{t} & = \lRat_{t} - \cRat_{t} \\
    \end{split}]]></tex-math>
      </disp-formula>
      <p>Because we’ve already made the pension decision, the amount of pension assets</p>
      <p>does not change in this loop and it just passes through to the post-decision</p>
      <p>value function.</p>
    </sec>
    <sec id="solving-the-problem">
      <title>Solving the problem</title>
      <sec id="solving-the-inner-consumption-saving-problem">
        <title>Solving the Inner Consumption Saving Problem</title>
        <p>Let’s start with the pure consumption-saving problem, which we can summarize by</p>
        <p>substitution as</p>
        <disp-formula>
          <label>(9)</label>
          <tex-math><![CDATA[\vOpt_{t}(\lRat_{t}, \bRat_{t}) = \max_{\cRat_{t}} \util(\cRat_{t}) - \kapShare +
    \vEnd_{t}(\lRat_{t} - \cRat_{t}, \bRat_{t})]]></tex-math>
        </disp-formula>
        <p>The first-order condition is</p>
        <disp-formula>
          <label>(10)</label>
          <tex-math><![CDATA[\util'(\cRat_{t}) = \vEnd_{t}^{\aRat}(\lRat_{t}-\cRat_{t}, \bRat_{t}) =
    \vEnd_{t}^{\aRat}(\aRat_{t}, \bRat_{t})]]></tex-math>
        </disp-formula>
        <p>We can invert this Euler equation as in standard EGM to obtain the consumption</p>
        <p>function.</p>
        <disp-formula>
          <label>(11)</label>
          <tex-math><![CDATA[\cEndFunc_{t}(\aRat_{t}, \bRat_{t}) =
    \util'^{-1}\left(\vEnd_{t}^{\aRat}(\aRat_{t}, \bRat_{t})\right)]]></tex-math>
        </disp-formula>
        <p>Again as before,
          <inline-formula>
            <tex-math><![CDATA[\lEndFunc_{t}(\aRat_{t}, \bRat_{t}) =
    \cEndFunc_{t}(\aRat_{t}, \bRat_{t}) + \aRat_{t}]]></tex-math>
          </inline-formula>. To sum up, using an
        </p>
        <p>exogenous</p>
        <p>grid of
          <inline-formula>
            <tex-math><![CDATA[(\aRat_{t}, \bRat_{t})]]></tex-math>
          </inline-formula> we obtain the trio
          <inline-formula>
            <tex-math><![CDATA[(\cEndFunc_{t}(\aRat_{t},
    \bRat_{t}), \lEndFunc_{t}(\aRat_{t},
    \bRat_{t}), \bRat_{t})]]></tex-math>
          </inline-formula> which
        </p>
        <p>provides an</p>
        <p>interpolating function for our optimal consumption decision rule over the</p>
        <p>
          <inline-formula>
            <tex-math><![CDATA[(\lRat, \bRat)]]></tex-math>
          </inline-formula> grid. Without loss of generality, assume
          <inline-formula>
            <tex-math><![CDATA[\lEndFunc_{t} =
    \lEndFunc_{t}(\aRat_{t}, \bRat_{t})]]></tex-math>
          </inline-formula> and define the interpolating
        </p>
        <p>function as</p>
        <disp-formula>
          <label>(12)</label>
          <tex-math><![CDATA[\cTarg_{t}(\lEndFunc_{t}, \bRat_{t}) \equiv \cEndFunc_{t}(\aRat_{t},
    \bRat_{t})]]></tex-math>
        </disp-formula>
        <p>For completeness, we derive the envelope conditions as well, and as we will</p>
        <p>see, these will be useful when solving the next section.</p>
        <disp-formula>
          <label>(13)</label>
          <tex-math><![CDATA[\begin{split}
        \vOpt_{t}^{\lRat}(\lRat_{t}, \bRat_{t}) & =
        \vEnd_{t}^{\aRat}(\aRat_{t}, \bRat_{t}) = \util'(\cRat_{t}) \\
        \vOpt_{t}^{\bRat}(\lRat_{t}, \bRat_{t}) & =
        \vEnd_{t}^{\bRat}(\aRat_{t}, \bRat_{t})
    \end{split}]]></tex-math>
        </disp-formula>
      </sec>
    </sec>
    <sec id="solving-the-outer-pension-deposit-problem">
      <title>Solving the Outer Pension Deposit Problem</title>
      <p>Now, we can move on to solving the deposit problem, which we can also summarize</p>
      <p>as</p>
      <disp-formula>
        <label>(14)</label>
        <tex-math><![CDATA[\vFunc_{t}(\mRat_{t}, \nRat_{t}, \Work) = \max_{\dRat_{t}}
    \vOpt_{t}(\mRat_{t}
    - \dRat_{t}, \nRat_{t} + \dRat_{t} + \gFunc(\dRat_{t}))]]></tex-math>
      </disp-formula>
      <p>The first-order condition is</p>
      <disp-formula>
        <label>(15)</label>
        <tex-math><![CDATA[\vOpt_{t}^{\lRat}(\lRat_{t}, \bRat_{t})(-1) +
    \vOpt_{t}^{\bRat}(\lRat_{t}, \bRat_{t})(1+\gFunc'(\dRat_{t})) = 0]]></tex-math>
      </disp-formula>
      <p>Rearranging this equation gives</p>
      <disp-formula>
        <label>(16)</label>
        <tex-math><![CDATA[\gFunc'(\dRat_{t}) = \frac{\vOpt_{t}^{\lRat}(\lRat_{t},
        \bRat_{t})}{\vOpt_{t}^{\bRat}(\lRat_{t}, \bRat_{t})} - 1]]></tex-math>
      </disp-formula>
      <p>Assuming that
        <inline-formula>
          <tex-math><![CDATA[\gFunc'(\dRat)]]></tex-math>
        </inline-formula> exists and is invertible, we can find
      </p>
      <disp-formula>
        <label>(17)</label>
        <tex-math><![CDATA[\dEndFunc_{t}(\lRat_{t}, \bRat_{t}) = \gFunc'^{-1}\left(
    \frac{\vOpt_{t}^{\lRat}(\lRat_{t},
        \bRat_{t})}{\vOpt_{t}^{\bRat}(\lRat_{t},
        \bRat_{t})} - 1 \right)]]></tex-math>
      </disp-formula>
      <p>Using this, we can back out
        <inline-formula>
          <tex-math><![CDATA[\nRat_{t}]]></tex-math>
        </inline-formula> as
      </p>
      <disp-formula>
        <label>(18)</label>
        <tex-math><![CDATA[\nEndFunc_{t}(\lRat_{t}, \bRat_{t}) = \bRat_{t} -
    \dEndFunc_{t}(\lRat_{t}, \bRat_{t}) - \gFunc(\dEndFunc_{t}(\lRat_{t},
        \bRat_{t}))]]></tex-math>
      </disp-formula>
      <p>and
        <inline-formula>
          <tex-math><![CDATA[\mRat_{t}]]></tex-math>
        </inline-formula> as
      </p>
      <disp-formula>
        <label>(19)</label>
        <tex-math><![CDATA[\mEndFunc_{t}(\lRat_{t}, \bRat_{t}) = \lRat_{t} +
    \dEndFunc_{t}(\lRat_{t}, \bRat_{t})]]></tex-math>
      </disp-formula>
      <p>In sum, given an exogenous grid
        <inline-formula>
          <tex-math><![CDATA[(\lRat_{t}, \bRat_{t})]]></tex-math>
        </inline-formula> we obtain the triple
      </p>
      <p>
        <inline-formula>
          <tex-math><![CDATA[\left(\mEndFunc_{t}(\lRat_{t}, \bRat_{t}), \nEndFunc_{t}(\lRat_{t},
        \bRat_{t}), \dEndFunc_{t}(\lRat_{t}, \bRat_{t})\right)]]></tex-math>
        </inline-formula>, which
      </p>
      <p>we can use to</p>
      <p>create an interpolator for the decision rule
        <inline-formula>
          <tex-math><![CDATA[\dRat_{t}]]></tex-math>
        </inline-formula>.
      </p>
      <p>To close the solution method, the envelope conditions are</p>
      <disp-formula>
        <label>(20)</label>
        <tex-math><![CDATA[\begin{split}
        \vFunc_{t}^{\mRat}(\mRat_{t}, \nRat_{t}, \Work) & =
        \vOpt_{t}^{\lRat}(\lRat_{t}, \bRat_{t}) \\
        \vFunc_{t}^{\nRat}(\mRat_{t}, \nRat_{t}, \Work) & =
        \vOpt_{t}^{\bRat}(\lRat_{t}, \bRat_{t})
    \end{split}]]></tex-math>
      </disp-formula>
    </sec>
    <sec id="is-g-invertible">
      <title>Is g invertible?</title>
      <p>We’ve already seen that
        <inline-formula>
          <tex-math><![CDATA[\util'(\cdot)]]></tex-math>
        </inline-formula> is invertible, but is
        <inline-formula>
          <tex-math><![CDATA[\gFunc]]></tex-math>
        </inline-formula>?
      </p>
      <disp-formula>
        <label>(21)</label>
        <tex-math><![CDATA[\gFunc(\dRat) = \xFer \log(1+\dRat) \qquad \gFunc'(\dRat) =
    \frac{\xFer}{1+\dRat} \qquad \gFunc'^{-1}(y) = \xFer/y - 1]]></tex-math>
      </disp-formula>
    </sec>
    <sec id="the-post-decision-value-and-marginal-value-functions">
      <title>The Post-Decision Value and Marginal Value Functions</title>
      <disp-formula>
        <label>(22)</label>
        <tex-math><![CDATA[\begin{split}
        \vEnd_{t}(\aRat, \bRat) & =  \DiscFac \Ex_{t} \left[
            \VFunc(\mRat_{t+1}, \nRat_{t+1}) \right] \\
        & \text{s.t.} \\
        \mRat_{t+1} & = \Rfree_{\aRat} \aRat_{t} + \tShkEmp_{t+1} \\
        \nRat_{t+1} & = \Rfree_{\bRat} \bRat_{t}
    \end{split}]]></tex-math>
      </disp-formula>
      <p>and</p>
      <disp-formula>
        <label>(23)</label>
        <tex-math><![CDATA[\begin{split}
        \vEnd_{t}^{\aRat}(\aRat_{t}, \bRat_{t}) & =  \DiscFac
        \Rfree_{\aRat} \Ex_{t} \left[ \VFunc^{\mRat}_{t+1}(\mRat_{t+1},
            \nRat_{t+1})
            \right] \\
        & \text{s.t.} \\
        \mRat_{t+1} & = \Rfree_{\aRat} \aRat_{t} + \tShkEmp_{t+1} \\
        \nRat_{t+1} & = \Rfree_{\bRat} \bRat_{t}
    \end{split}]]></tex-math>
      </disp-formula>
      <p>and</p>
      <disp-formula>
        <label>(24)</label>
        <tex-math><![CDATA[\begin{split}
        \vEnd_{t}^{\bRat}(\aRat_{t}, \bRat_{t}) & =  \DiscFac
        \Rfree_{\bRat} \Ex_{t} \left[ \VFunc^{\nRat}_{t+1}(\mRat_{t+1},
            \nRat_{t+1})
            \right] \\
        & \text{s.t.} \\
        \mRat_{t+1} & = \Rfree_{\aRat} \aRat_{t} + \tShkEmp_{t+1} \\
        \nRat_{t+1} & = \Rfree_{\bRat} \bRat_{t}
    \end{split}]]></tex-math>
      </disp-formula>
    </sec>
    <sec id="taste-shocks">
      <title>Taste Shocks</title>
      <p>From discrete choice theory and from DCEGM paper, we know that</p>
      <disp-formula>
        <label>(25)</label>
        <tex-math><![CDATA[\Ex_{t} \left[
        \VFunc_{t+1}(\mRat_{t+1}, \nRat_{t+1}, \error_{t+1}) \right] =
    \sigma \log \left[ \sum_{\Decision \in \{\Work, \Retire\}} \exp \left(
        \frac{\vFunc_{t+1}(\mRat_{t+1}, \nRat_{t+1},
            \Decision)}{\sigma_\error}	\right) 	\right]]]></tex-math>
      </disp-formula>
      <p>and</p>
      <disp-formula>
        <label>(26)</label>
        <tex-math><![CDATA[\Prob_{t}(\Decision ~ \lvert ~ \mRat_{t+1}, \nRat_{t+1}) = \frac{\exp
        \left(
        \vFunc_{t + 1}(\mRat_{t+1}, \nRat_{t+1}, \Decision) /
        \sigma_\error
        \right)
    }{  \sum\limits_{\Decision \in \{\Work, \Retire\}}	\exp \left(
        \frac{\vFunc_{t+1}(\mRat_{t+1}, \nRat_{t+1},
            \Decision)}{\sigma_\error}	\right)}]]></tex-math>
      </disp-formula>
      <p>the first-order conditions are therefore</p>
      <disp-formula>
        <label>(27)</label>
        <tex-math><![CDATA[\vOptAlt_{t}^{\mRat}(\mRat_{t+1}, \nRat_{t+1}) = \sum_{\Decision \in
        \{\Work, \Retire\}} \Prob_{t}(\Decision ~
    \lvert ~
    \mRat_{t+1}, \nRat_{t+1}) \vFunc_{t+1}^{\mRat}(\mRat_{t+1},
    \nRat_{t+1},
    \Decision)]]></tex-math>
      </disp-formula>
      <p>Web</p>
      <p>[figure]list=no</p>
      <p>[table]list=no</p>
      <p>document</p>
    </sec>
  </body>
</article>
