\input{./econtexRoot.texinput}
\documentclass[\econtexRoot/EGMN]{subfiles}

% \onlyinsubfile{\renewcommand{\econtexRoot}{..}} %
\onlyinsubfile{\externaldocument{\econtexRoot/EGMN}} % Get xrefs -- esp to apndx -- from main file; only works if main file

\usepackage{\econtexSetup,\econark,\econtexShortcuts}


\begin{document}

\hypertarget{parameterizing-the-model}{}\par\section{Parameterizing the model}

\section{The EGM$^N$ in Higher Dimmensions}

\subsection{A more complex problem}

The problem above demonstrates the simplicity of solving problems sequentially. However, as constructed, the problem has only 1 state variable and 1 post-decision state variable per stage. Can EGM$^N$ be used to solve higher dimmensional problems? In short, yes, but it requires additional thought on interpolation.

For a demonstration, we now turn to the problem of a worker saving up for retirement. This worker must consume, save, and deposit resources into a tax-advantaged account that can not be liquidated until retirement. In the recursive problem, the worker begins a new period with a liquid account of market resources $\mRat$ and an illiquid account of retirement savings $\nRat$. The worker maximizes their utility by choosing consumption $\cRat$ and pension deposit $\dRat$. The pension deposit is set aside on a retirement account that is exposed to a risky return, while their post-consumption liquid assets accrue risk-free interest every period. The worker additionally receives an income which faces a permanent ($\PGro$) and a transitory ($\tShkEmp$) shock every period. At the age of 65, the worker is retired and their assets are liquidated, at which point the state reduces to one liquid account of market resources. The worker's recursive problem is:

\providecommand{\lRat}{\ensuremath{l}}

\begin{equation}
    \begin{split}
        \vFunc_{t}(\mRat_{t}, \nRat_{t}) & = \max_{\cRat_{t}, \dRat_{t}} \util(\cRat_{t}) + \DiscFac \Ex_{t} \left[ \PGro_{t+1}^{1-\CRRA} \vFunc_{t+1}(\mRat_{t+1}, \nRat_{t+1}) \right] \\
        & \text{s.t.} \quad \cRat_{t} \ge 0, \quad \dRat_{t} \ge 0 \\
        \aRat_{t} & = \mRat_{t} - \cRat_{t} - \dRat_{t} \\
        \bRat_{t} & = \nRat_{t} + \dRat_{t} + g(\dRat_{t}) \\
        \mRat_{t+1} & = \aRat_{t} \Rfree / \PGro_{t+1}  + \tShkEmp_{t+1} \\
        \nRat_{t+1} & = \bRat_{t} \Risky_{t+1} / / \PGro_{t+1}
    \end{split}
\end{equation}

This problem can subsequently be broken down into 3 stages: a pension deposit stage, a consumption stage, and an expectation stage.

In the deposit stage, the worker begins with market resources and a retirement savings account. The worker must maximize their value of liquid wealth $\lRat$ and retirement balance $\bRat$ by choosing a pension deposit $\dRat$, which must be positive. The retirement balance $\bRat$ is the cash-value of their retirement account plus their pension deposit and an additional amount $g(\dRat_{t})$ that provides an incentive to save for retirement. As we'll see, this additional term will allow us to use the endogenous grid method to solve this sub-problem.

\begin{equation}
    \begin{split}
        \vFunc_{t}(\mRat_{t}, \nRat_{t}) & = \max_{\dRat_{t}} \vOpt_{t}(\lRat_{t}, \bRat_{t}) \\
        & \text{s.t.}  \quad \dRat_{t} \ge 0 \\
        \lRat_{t} & = \mRat_{t} - \dRat_{t} \\
        \bRat_{t} & = \nRat_{t} + \dRat_{t} + g(\dRat_{t})
    \end{split}
\end{equation}

After making their pension decision, the worker begins their consumption stage with liquid wealth $\lRat$ and retirement balance $\bRat$. From their liquid wealth, the worker must choose a level of consumption to maximize utility and continuation value $\wFunc$. After consumption, the worker is left with post-decision states that represent liquid assets $\aRat$ and retirement balance $\bRat$, which passes through this problem unaffected because it can't be liquidated until retirement.

\begin{equation}
    \begin{split}
        \vOpt_{t}(\lRat_{t}, \bRat_{t}) & = \max_{\cRat_{t}} \util(\cRat_{t}) + \DiscFac \wFunc_{t}(\aRat_{t}, \bRat_{t})  \\
        & \text{s.t.} \quad \cRat_{t} \ge 0 \\
        \aRat_{t} & = \mRat_{t} - \cRat_{t} - \dRat_{t} \\
        \bRat_{t} & = \nRat_{t} + \dRat_{t} + g(\dRat_{t})
    \end{split}
\end{equation}

Finally, the post-decision value function $\wFunc$ represents the value of both liquid and illiquid account balances before the realization of uncertainty regarding the risky return and income shocks. Since we are dealing with a normalized problem, this stage handles the normalization of state variables and value functions into the next period. The advantage of conceptualizing this sub-problem as a separate stage is that we can construct a function $\wFunc$ and use it in the prior optimization problems without having to worry about stochastic optimization.

\begin{equation}
    \begin{split}
        \wFunc_{t}(\aRat_{t}, \bRat_{t}) & = \Ex_{t} \left[ \PGro_{t+1}^{1-\CRRA} \vFunc_{t+1}(\mRat_{t+1}, \mRat_{t+1}) \right] \\
        & \text{s.t.} \quad \aRat_{t} \ge 0, \quad \bRat_{t} \ge 0 \\
        \mRat_{t+1} & = \aRat_{t} \Rfree / \PGro_{t+1}  + \tShkEmp_{t+1} \\
        \nRat_{t+1} & = \bRat_{t} \Risky_{t+1} / / \PGro_{t+1}
    \end{split}
\end{equation}

\subsection{The pass-through case}

As seen in the consumption stage above, the retirement balance $\bRat$ passes through the problem unaffected because it can't be liquidated until retirement. In this sense, it is already a post-decision state variable. To solve this problem, we can use a fixed grid of $\bRat$ and for each obtain endogenous consumption and ex-ante market resources using the simple endogenous grid method for the consumption problem.

\subsection{Non-rectilinear grids}

\includegraphics[width=\textwidth]{Figures/ExogenousGrid.pdf}


\providecommand{\gFunc}{\ensuremath{\mathrm{g}}}


In the deposit stage, both the state variables and post-decision variables are different since both are affected by the pension deposit decision.

First, we can rewrite the pension deposit problem more compactly as:

\begin{equation}
    \vFunc_{t}(\mRat_{t}, \nRat_{t}) = \max_{\dRat_{t}}
    \vOpt_{t}(\mRat_{t}
    - \dRat_{t}, \nRat_{t} + \dRat_{t} + \gFunc(\dRat_{t}))
\end{equation}

The first order condition is

\begin{equation}
    \vOpt_{t}^{\lRat}(\lRat_{t}, \bRat_{t})(-1) +
    \vOpt_{t}^{\bRat}(\lRat_{t}, \bRat_{t})(1+\gFunc'(\dRat_{t})) = 0
\end{equation}

Rearranging this equation gives

\begin{equation}
    \gFunc'(\dRat_{t}) = \frac{\vOpt_{t}^{\lRat}(\lRat_{t},
        \bRat_{t})}{\vOpt_{t}^{\bRat}(\lRat_{t}, \bRat_{t})} - 1
\end{equation}

Assuming that $\gFunc'(\dRat)$ exists and is invertible, we can find

\providecommand{\dEndFunc}{\ensuremath{\mathfrak{d}}}

\begin{equation}
    \dEndFunc_{t}(\lRat_{t}, \bRat_{t}) = \gFunc'^{-1}\left(
    \frac{\vOpt_{t}^{\lRat}(\lRat_{t},
        \bRat_{t})}{\vOpt_{t}^{\bRat}(\lRat_{t},
        \bRat_{t})} - 1 \right)
\end{equation}

Using this, we can back out $\nRat_{t}$ as

\providecommand{\nEndFunc}{\ensuremath{\mathfrak{n}}}

\begin{equation}
    \nEndFunc_{t}(\lRat_{t}, \bRat_{t}) = \bRat_{t} -
    \dEndFunc_{t}(\lRat_{t}, \bRat_{t}) - \gFunc(\dEndFunc_{t}(\lRat_{t},
        \bRat_{t}))
\end{equation}

and $\mRat_{t}$ as

\begin{equation}
    \mEndFunc_{t}(\lRat_{t}, \bRat_{t}) = \lRat_{t} +
    \dEndFunc_{t}(\lRat_{t}, \bRat_{t})
\end{equation}

In sum, given an exogenous grid $(\lRat_{t}, \bRat_{t})$ we obtain the triple
$\left(\mEndFunc_{t}(\lRat_{t}, \bRat_{t}), \nEndFunc_{t}(\lRat_{t},
        \bRat_{t}), \dEndFunc_{t}(\lRat_{t}, \bRat_{t})\right)$, which
we can use to
create an interpolator for the decision rule $\dRat_{t}$.

To close the solution method, the envelope conditions are

\begin{equation}
    \begin{split}
        \vFunc_{t}^{\mRat}(\mRat_{t}, \nRat_{t}) & =
        \vOpt_{t}^{\lRat}(\lRat_{t}, \bRat_{t}) \\
        \vFunc_{t}^{\nRat}(\mRat_{t}, \nRat_{t}) & =
        \vOpt_{t}^{\bRat}(\lRat_{t}, \bRat_{t})
    \end{split}
\end{equation}

\includegraphics[width=\textwidth]{Figures/EndogenousGrid.pdf}

\subsection{Unstructured Grid Interpolation}

To interpolate a function defined on an unstructured grid, we use Gaussian Process Regression as in \cite{Scheidegger2019-xf}.

\ifthenelse{\boolean{Web}}{}{
\end{document} \endinput
}
